#!/bin/bash

CUR_DIR="$( cd "$( dirname "$0" )" && pwd )"
PROTO_DIR=$CUR_DIR/../proto
DESKTOP_DIR=$CUR_DIR/../../../umit/icm/agent/rpc

echo "Compiling OpenMonitor protobuf messages for Desktop Agent..."
protoc -I=$PROTO_DIR --python_out=$DESKTOP_DIR $PROTO_DIR/messages.proto

echo "Converting import statements..."
sed -i 's/from google.protobuf/from protobuf/g' $DESKTOP_DIR/messages_pb2.py

echo "Done! Saved to $DESKTOP_DIR/messages_pb2.py"